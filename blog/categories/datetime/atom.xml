<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: DateTime | Lester Zhao's Blog]]></title>
  <link href="http://lester.izstudy.com/blog/categories/datetime/atom.xml" rel="self"/>
  <link href="http://lester.izstudy.com/"/>
  <updated>2014-01-15T17:08:58+08:00</updated>
  <id>http://lester.izstudy.com/</id>
  <author>
    <name><![CDATA[Lester Zhao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[simple_form datetime 字段 显示的时间不正确]]></title>
    <link href="http://lester.izstudy.com/blog/2014/01/11/simple-form-datetime-field-with-wrong-time-zone/"/>
    <updated>2014-01-11T14:32:00+08:00</updated>
    <id>http://lester.izstudy.com/blog/2014/01/11/simple-form-datetime-field-with-wrong-time-zone</id>
    <content type="html"><![CDATA[<p>simple_form 能够简化我们 rails 中创建表单的工作。 他还提供了高级功能让我们自定义表单的所有内容。</p>

<h2>问题产生</h2>

<p>当我们使用 simple_form 建立时间字段的时候，例如：</p>

<p>{% codeblock lang:ruby %}
&lt;%= simple_form_for(@user, html: { class: &lsquo;form-horizontal&rsquo; }) do |f| %>
  &lt;%= f.input :created_at %>
  <div class="form-actions"></p>

<pre><code>&lt;%= f.button :submit %&gt;
</code></pre>

<p>  </div>
&lt;% end %>
{% endcodeblock %}</p>

<p>默认的情况下 created_at 再表单中的时间是没有问题的。</p>

<p>但是当我们不满足于默认时间字段的多个 select html控件来选择时间， 而使用 DateTime Picker 更友好的方式设置时间的时候，我们需要这样做：</p>

<p>{% codeblock lang:ruby %}
&lt;%= simple_form_for(@user, html: { class: &lsquo;form-horizontal&rsquo; }) do |f| %>
  &lt;%= f.input :created_at, as: :string, input_html: {class: &lsquo;datetime&rsquo;}%>
&lt;% end %>
{% endcodeblock %}</p>

<p>然后用 js 去生成时间日期选择。</p>

<p>这个时候会发现 created_at表单中的时间不是正确的。原因是Rails从数据库中读取时间字段后没有经过时区转换就被 simple_form 使用了</p>

<p>有关 <a href="http://lester.izstudy.com/blog/2014/01/11/simple-form-datetime-field-does-not-use-right-timezone/">Rails中如何正确使用时间</a> 请点击查看。</p>

<h2>解决方法</h2>

<h3>最简单的解决办法是：</h3>

<p>{% codeblock lang:ruby %}
&lt;%= simple_form_for(@user, html: { class: &lsquo;form-horizontal&rsquo; }) do |f| %>
  &lt;%= f.input :created_at, as: :string, input_html: { class: &lsquo;datetime&rsquo;, value: f.object.created_at }%>
&lt;% end %>
{% endcodeblock %}</p>

<h3>更好的解决办法：</h3>

<p>如果程序中有很多这样的地方需要处理的话，每个去修改不是最明智的选择。 最好是利用 simple_form 重新定义 datetime 表单内容。</p>

<p>创建文件 app/inputs/date_time_input.rb
{% codeblock lang:ruby %}
class DateTimeInput &lt; SimpleForm::Inputs::Base
  def input()</p>

<pre><code>@builder.text_field(attribute_name, input_html_options.merge( { class: 'datetime', value: object.send( attribute_name ) } ))
</code></pre>

<p>  end
end
{% endcodeblock %}</p>

<p>重新启动程序， 所有Datetime类型的字段都会自动生成这种时间选择表单， 并且时间是正确的了。</p>
]]></content>
  </entry>
  
</feed>
